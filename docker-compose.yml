# GigaBot Docker Compose
# Usage: docker compose up -d
# Dashboard: http://localhost:18790/

services:
  gigabot:
    build: .
    container_name: gigabot
    restart: unless-stopped
    
    ports:
      - "18790:18790"
    
    volumes:
      # Configuration directory
      - ./config:/root/.nanobot
      # Workspace - agent's working directory  
      - ./workspace:/root/.nanobot/workspace
    
    environment:
      # LLM Provider API Keys (at least one required)
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - MOONSHOT_API_KEY=${MOONSHOT_API_KEY:-}
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY:-}
      
      # Channel Tokens (optional)
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN:-}
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN:-}
      - SLACK_APP_TOKEN=${SLACK_APP_TOKEN:-}
      
      # Web Search (optional)
      - BRAVE_API_KEY=${BRAVE_API_KEY:-}
      
      # Security (optional)
      - NANOBOT_AUTH_MODE=${NANOBOT_AUTH_MODE:-none}
      - NANOBOT_AUTH_TOKEN=${NANOBOT_AUTH_TOKEN:-}
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:18790/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Optional: WhatsApp Bridge (enable with --profile whatsapp)
  whatsapp-bridge:
    image: node:20-slim
    container_name: gigabot-whatsapp
    restart: unless-stopped
    profiles:
      - whatsapp
    
    working_dir: /app/bridge
    command: npm start
    
    volumes:
      - ./bridge:/app/bridge
      - whatsapp-data:/app/bridge/.wwebjs_auth
    
    ports:
      - "3001:3001"
    
    environment:
      - PORT=3001
    
    depends_on:
      - gigabot

volumes:
  whatsapp-data:
